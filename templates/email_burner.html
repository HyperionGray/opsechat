<!doctype html>
<html lang="en">
<head>
<title>Burner Email - OpSec</title>
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    background-color: #000;
    color: #0f0;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    padding: 20px;
    min-height: 100vh;
  }

  .header {
    border-bottom: 2px solid #0f0;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }

  h1 {
    color: #0f0;
    font-size: 24px;
  }

  h2 {
    color: #0ff;
    font-size: 20px;
    margin: 20px 0 10px 0;
  }

  .nav {
    margin: 20px 0;
  }

  .nav a {
    color: #0f0;
    text-decoration: none;
    margin-right: 20px;
    padding: 5px 10px;
    border: 1px solid #0f0;
    display: inline-block;
    margin-bottom: 10px;
  }

  .nav a:hover {
    background-color: #0f0;
    color: #000;
  }

  .content {
    max-width: 1200px;
    margin: 20px auto;
  }

  .info {
    background-color: #003;
    border: 1px solid #0ff;
    color: #0ff;
    padding: 15px;
    margin: 20px 0;
  }

  .success {
    background-color: #030;
    border: 1px solid #0f0;
    color: #0f0;
    padding: 15px;
    margin: 20px 0;
  }

  .warning {
    background-color: #330;
    border: 1px solid #f90;
    color: #f90;
    padding: 15px;
    margin: 20px 0;
  }

  button, .button {
    background-color: #000;
    color: #0f0;
    border: 1px solid #0f0;
    padding: 10px 20px;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    cursor: pointer;
    margin: 10px 5px;
    display: inline-block;
    text-decoration: none;
  }

  button:hover, .button:hover {
    background-color: #0f0;
    color: #000;
  }

  button.danger {
    border-color: #f00;
    color: #f00;
  }

  button.danger:hover {
    background-color: #f00;
    color: #fff;
  }

  .burner-list {
    margin: 20px 0;
  }

  .burner-card {
    background-color: #111;
    border: 2px solid #0f0;
    padding: 20px;
    margin: 15px 0;
    position: relative;
    transition: border-color 0.3s;
  }

  .burner-card.expiring-soon {
    border-color: #f90;
  }

  .burner-card.expired {
    border-color: #f00;
    opacity: 0.6;
  }

  .burner-email {
    font-size: 20px;
    color: #0ff;
    word-break: break-all;
    margin: 10px 0;
    font-weight: bold;
  }

  .burner-meta {
    color: #888;
    font-size: 14px;
    margin: 10px 0;
  }

  .time-remaining {
    color: #0f0;
    font-size: 18px;
    margin: 10px 0;
  }

  .time-remaining.expiring {
    color: #f90;
  }

  .time-remaining.expired {
    color: #f00;
  }

  .burner-actions {
    margin-top: 15px;
  }

  .features {
    margin: 20px 0;
    padding: 15px;
    border: 1px solid #0f0;
  }

  .features ul {
    margin-left: 20px;
    margin-top: 10px;
  }

  .features li {
    margin: 8px 0;
  }

  .stats {
    display: flex;
    gap: 20px;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  .stat-box {
    background-color: #111;
    border: 1px solid #0f0;
    padding: 15px;
    flex: 1;
    min-width: 200px;
  }

  .stat-value {
    font-size: 32px;
    color: #0ff;
    font-weight: bold;
  }

  .stat-label {
    color: #888;
    font-size: 14px;
  }

  .generate-section {
    text-align: center;
    margin: 30px 0;
    padding: 30px;
    border: 2px dashed #0f0;
  }

  .empty-state {
    text-align: center;
    padding: 50px 20px;
    color: #888;
  }

  @media (max-width: 768px) {
    body {
      padding: 10px;
      font-size: 14px;
    }

    .burner-email {
      font-size: 16px;
    }

    .stats {
      flex-direction: column;
    }
  }
</style>

<body>
  <div class="header">
    <h1>üî• Burner Email Generator</h1>
    <p>Modern rotating anonymous email addresses</p>
  </div>

  <div class="nav">
    <a href="/{{ path }}/email">üìß Inbox</a>
    <a href="/{{ path }}">üí¨ Chat</a>
    {% if script_enabled %}
    <a href="/{{ path }}/email/burner">NoScript Mode</a>
    {% else %}
    <a href="/{{ path }}/email/burner/yesscript">Enable JavaScript</a>
    {% endif %}
  </div>

  <div class="content">
    <!-- Stats Section -->
    {% if active_burners %}
    <div class="stats">
      <div class="stat-box">
        <div class="stat-value">{{ active_burners|length }}</div>
        <div class="stat-label">Active Burners</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="total-time">{{ active_burners|length * 24 }}h</div>
        <div class="stat-label">Total Time Remaining</div>
      </div>
    </div>
    {% endif %}

    <!-- Generate New Burner Section -->
    <div class="generate-section">
      <h2>üöÄ Generate New Burner</h2>
      <p style="margin: 15px 0; color: #888;">
        Create a new temporary email address for anonymous communication
      </p>
      <form method="POST" action="/{{ path }}/email/burner" style="display: inline;">
        <input type="hidden" name="action" value="generate">
        <button type="submit">Generate New Burner Email</button>
      </form>
    </div>

    <!-- Active Burners List -->
    {% if active_burners %}
    <h2>üì¨ Active Burner Emails</h2>
    <div class="burner-list" id="burner-list">
      {% for burner in active_burners %}
      <div class="burner-card {% if burner.time_remaining_seconds < 3600 %}expiring-soon{% endif %}" data-email="{{ burner.email }}" data-expires="{{ burner.time_remaining_seconds }}">
        <div class="burner-email">{{ burner.email }}</div>
        
        <div class="burner-meta">
          Created: {{ burner.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
          <br>
          Expires: {{ burner.expires_at.strftime('%Y-%m-%d %H:%M:%S') }}
        </div>
        
        <div class="time-remaining {% if burner.time_remaining_seconds < 3600 %}expiring{% endif %}" data-seconds="{{ burner.time_remaining_seconds }}">
          ‚è±Ô∏è Time Remaining: <span class="countdown">{{ burner.time_remaining_str }}</span>
        </div>
        
        <div class="burner-actions">
          <button onclick="copyToClipboard('{{ burner.email }}')">üìã Copy Email</button>
          <a href="/{{ path }}/email" class="button">üìß View Inbox</a>
          <form method="POST" action="/{{ path }}/email/burner" style="display: inline;">
            <input type="hidden" name="action" value="rotate">
            <input type="hidden" name="old_email" value="{{ burner.email }}">
            <button type="submit">üîÑ Rotate (Generate New)</button>
          </form>
          <form method="POST" action="/{{ path }}/email/burner/expire/{{ burner.email }}" style="display: inline;">
            <button type="submit" class="danger">üóëÔ∏è Delete Now</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <h2>No Active Burner Emails</h2>
      <p>Generate your first burner email to get started!</p>
    </div>
    {% endif %}

    <!-- Info Section -->
    <div class="info">
      üí° <strong>How Burner Emails Work:</strong><br><br>
      <ul style="margin-left: 20px;">
        <li><strong>No Login Required:</strong> Instant anonymous email addresses</li>
        <li><strong>24-Hour Validity:</strong> Each email expires after 24 hours</li>
        <li><strong>Auto-Rotation:</strong> Generate new emails or rotate existing ones</li>
        <li><strong>Multiple Active:</strong> Keep several burner emails active at once</li>
        <li><strong>Real-Time Updates:</strong> See countdown timers with JavaScript enabled</li>
        <li><strong>Privacy First:</strong> All data stored in memory, nothing hits disk</li>
      </ul>
    </div>

    <div class="features">
      <h3 style="color: #0ff; margin-bottom: 10px;">‚ú® Modern Features:</h3>
      <ul>
        <li><strong>Quick Rotation:</strong> One-click rotation to new addresses</li>
        <li><strong>Live Countdowns:</strong> Real-time expiry timers (with JS)</li>
        <li><strong>Multiple Burners:</strong> Manage several addresses simultaneously</li>
        <li><strong>Instant Copy:</strong> One-click copy to clipboard</li>
        <li><strong>Direct Inbox:</strong> Quick link to view emails</li>
        <li><strong>Manual Expiry:</strong> Delete burners before they expire</li>
        <li><strong>Tor-Compatible:</strong> Works seamlessly over Tor network</li>
        <li><strong>PGP Support:</strong> Use with encrypted communications</li>
      </ul>
    </div>

    <div class="warning">
      ‚ö†Ô∏è <strong>Privacy Notes:</strong>
      <ul style="margin-left: 20px; margin-top: 10px;">
        <li>Burner emails expire automatically after 24 hours</li>
        <li>All data stored in memory - lost on server restart</li>
        <li>For real email, configure SMTP/IMAP in settings</li>
        <li>Consider using PGP encryption for sensitive messages</li>
        <li>Access via Tor Browser for maximum anonymity</li>
      </ul>
    </div>
  </div>

  <script>
    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(function() {
          alert('‚úÖ Email address copied to clipboard!');
        }, function(err) {
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        alert('‚úÖ Email address copied to clipboard!');
      } catch (err) {
        alert('‚ùå Failed to copy. Please copy manually: ' + text);
      }
      document.body.removeChild(textArea);
    }

    {% if script_enabled %}
    // Live countdown updates
    function updateCountdowns() {
      const countdownElements = document.querySelectorAll('.time-remaining[data-seconds]');
      
      countdownElements.forEach(function(element) {
        let seconds = parseInt(element.getAttribute('data-seconds'));
        
        if (seconds > 0) {
          seconds--;
          element.setAttribute('data-seconds', seconds);
          
          const hours = Math.floor(seconds / 3600);
          const minutes = Math.floor((seconds % 3600) / 60);
          const secs = seconds % 60;
          
          let timeStr;
          if (hours > 0) {
            timeStr = hours + 'h ' + minutes + 'm';
          } else if (minutes > 0) {
            timeStr = minutes + 'm ' + secs + 's';
          } else {
            timeStr = secs + 's';
          }
          
          const countdownSpan = element.querySelector('.countdown');
          if (countdownSpan) {
            countdownSpan.textContent = timeStr;
          }
          
          // Update styling based on time remaining
          const card = element.closest('.burner-card');
          if (seconds < 3600) {
            element.classList.add('expiring');
            if (card) card.classList.add('expiring-soon');
          }
          if (seconds < 300) {
            element.classList.add('expired');
          }
        } else {
          element.querySelector('.countdown').textContent = 'Expired';
          element.classList.add('expired');
          const card = element.closest('.burner-card');
          if (card) card.classList.add('expired');
        }
      });
    }

    // Update every second
    setInterval(updateCountdowns, 1000);

    // Auto-refresh burner list every 30 seconds
    function refreshBurnerList() {
      fetch('/{{ path }}/email/burner/list')
        .then(response => response.json())
        .then(burners => {
          // Update the list (simple reload for now)
          // In a more advanced implementation, we'd update the DOM directly
          console.log('Burners refreshed:', burners.length);
        })
        .catch(err => console.error('Error refreshing burners:', err));
    }

    setInterval(refreshBurnerList, 30000);
    {% endif %}
  </script>
</body>
</html>
